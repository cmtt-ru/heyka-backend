# Socket API

Сокет-сервер реализован с помощью библиотеки [socket.io](https://socket.io), поэтому для подключения рекомендуется использовать эту же библиотеку на клиенте.

# Терминология

События будут описываться в таком формате:

```
event_type: 'from-client' | 'from-server',
event_name: 'unique name',
data: {
  field1: '...',
  field2: '...'
}
```

Где `event_type` используется для указания **откуда** данное событие может быть инициировано. Если `event_type = 'from-client'`, значит это событие должно быть инициировано на клиенте, и это же событие слушается сервером

# Аутентификация

Просто подключиться к сокет-серверу недостаточно. Прежде чем клиент сможет получать\посылать события на сервер, подключение должно аутентифицироваться. Чтобы осуществить процедуру, нужно послать событие следующего формата:

```
event_type: 'from-client',
event_name: 'auth',
data: {
  transaction: 'Уникальная строка, опционально',
  data: 'Access token, который клиент получил после аутентификации на сервере'
}
```

Индикатор того, что сокет теперь связан с аккаунтом пользователя служит событие

```
event_type: 'from-server'
event_name: 'auth-success',
data: {
  transaction: 'Уникальная строка, переданная событием from-client:auth',
  userId: 'Идентификатор пользователя'
}
```

В случае неудачной аутентификации будет возвращена ошибка по схеме, описанной в разделе [ошибки](#ошибки)

# Ошибки

Клиент, вызывая событие, в объекте с данными может передать свойство `transaction` - произвольную строчку. Если в процессе обработки этого события произойдет ошибка, сервер сгенерирует два события в ответ:

```
event_type: 'from-server'
event_name: 'socket-api-error'
data: {
  event: 'Название события, при обработки которого произошла ошибка',
  message: 'Текстовое описание ошибки'
}
```

```
event_type: 'from-server'
event_name: 'socket-api-error-${transaction}'
data: 'Текстовое описание ошибки'
```

Таким образом, клиент может генерировать события, передавая с ним значение `transaction` и подписываться на событие `socket-api-error-${transaction}`, чтобы узнать об ошибке. Также клиент может слушать все ошибки, которые возникли при обработки событий с данного конкретного клиента, подписавшись на `socket-api-error`.

# События сервер

## Каналы

### Канал создан

```
event_type: 'from-server'
event_name: 'channel-created'
data: ChannelModel
```